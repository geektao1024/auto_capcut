# CapCut 草稿自动生成器 v3.2.0

自动生成CapCut视频草稿，包含音频智能分段、图片自动分配、画面特效等功能。

**字幕功能**：请在CapCut中使用内置的「智能字幕」功能（更准确、更方便）。

## 🚀 快速开始

```bash
# 1. 安装依赖（已移除openai-whisper）
pip3 install pydub mutagen pillow

# 2. 运行脚本
python3 auto_capcut_draft_enhanced.py

# 或双击
./生成草稿.command

# 3. 在CapCut中添加字幕
# 打开草稿 → 点击「文字」→「智能字幕」→ 选择语言 → 开始识别
```

## ✨ 主要功能

### 1. 音频智能分段

- ✅ 自动检测并移除静音（4种消音模式）
- ✅ 音频预加速到1.08x
- ✅ 音量增益+13.6dB
- ✅ 每个音频片段独立可调

### 2. 智能图片分配

- ✅ 短音频(<1.5s) → 1张图片
- ✅ 长音频(≥1.5s) → 2张图片平均分配
- ✅ 自动优化视觉节奏

### 3. 字幕功能（推荐使用CapCut内置）

- ✅ 在CapCut中点击「文字」→「智能字幕」
- ✅ 支持多种语言的自动识别
- ✅ 准确率高、操作简单
- ✅ 可自定义样式和动画效果
- ✅ 支持逐词、逐句等多种显示模式

### 4. 画面效果

- ✅ 9:16竖屏（1080x1920）
- ✅ 震动特效（可调强度和速度）
- ✅ 背景模糊填充（37.5%）
- ✅ 开头音效（惊叹音效.WAV）

### 5. 素材管理

- ✅ 所有素材显示在CapCut左侧材料库
- ✅ 支持批量项目处理
- ✅ 自动文件命名和组织

## 📋 配置说明

在 `auto_capcut_draft_enhanced.py` 文件顶部修改配置：

### 音频配置

```python
AUDIO_VOLUME_DB = 13.6    # 音量增益（dB）
AUDIO_SPEED = 1.08        # 播放速度
```

### 画布配置

```python
CANVAS_WIDTH = 1080       # 竖屏宽度
CANVAS_HEIGHT = 1920      # 竖屏高度
CANVAS_RATIO = "9:16"     # 画布比例
```

### 字幕配置

字幕功能已移除，请在CapCut中使用「智能字幕」：
1. 打开生成的草稿
2. 点击「文字」→「智能字幕」
3. 选择语言（英文/中文等）
4. 点击「开始识别」

### 特效配置

```python
ENABLE_SHAKE_EFFECT = True   # 震动特效
SHAKE_SPEED = 2.0            # 速度（0-10）
SHAKE_INTENSITY = 5.0        # 强度（0-10）

ENABLE_CANVAS_BLUR = True    # 背景模糊
CANVAS_BLUR_AMOUNT = 0.375   # 模糊度（0-1）
```

## 📁 文件结构

```
项目目录/
├── auto_capcut_draft_enhanced.py  # 主程序 ⭐
├── 生成草稿.command               # 一键启动（macOS）
├── 惊叹音效.WAV                   # 开头音效
├── README.md                      # 本文档
├── jiaoben/                       # 脚本文件
├── reference_images/              # 参考图片
├── browser_data/                  # 浏览器数据
└── logs/                          # 日志文件

素材目录（/Users/mac/YouTube/00批量出图/）/
└── 项目文件夹/
    ├── xxx.mp3                    # 音频文件
    └── xxx.png                    # 图片文件（多张）
```

## 🎯 使用流程

### 1. 准备素材

在 `/Users/mac/YouTube/00批量出图/` 下创建项目文件夹，放入：

- 1个音频文件（.mp3/.wav）
- 多张图片文件（.png/.jpg）

### 2. 运行脚本

```bash
python3 auto_capcut_draft_enhanced.py
```

### 3. 选择项目

脚本会列出所有可用项目，选择一个（或直接回车选择默认）

### 4. 选择消音模式

- 模式0：不消音（保留原音频）
- 模式1：温和消音（min_silence=500ms, thresh=-40dB）
- 模式2：标准消音（min_silence=300ms, thresh=-35dB）
- 模式3：激进消音（min_silence=200ms, thresh=-30dB）⭐ 推荐

### 5. 等待处理

- 音频分段处理
- Whisper字幕识别（约20秒/分钟音频）
- 草稿生成

### 6. 在CapCut中编辑

- 自动打开CapCut
- 在时间线上查看并编辑字幕
- 微调画面和音效

## 🎬 CapCut草稿结构

生成的草稿包含以下轨道（从上到下）：

```
1. 震动特效轨道（effect）  - 覆盖整个视频
2. 视频轨道（video）        - 图片序列
3. 主音频轨道（audio）      - 分段音频
4. 字幕轨道（text）         - Whisper识别的字幕 ✨
5. 音效轨道（audio）        - 开头音效
```

### 轨道详情

**视频轨道**：

- 智能分配图片到音频段
- 每张图片包含背景模糊效果
- 自动适配9:16竖屏

**音频轨道**：

- 多个独立片段（可单独调整）
- 已预加速到1.08x
- 音量已增益+13.6dB

**字幕轨道**：

- 逐词显示（每个单词独立片段）
- 精确时间戳（Whisper识别）
- 1012官方样式
- 可在时间线直接编辑

## 📝 字幕功能说明

### Whisper模型选择

| 模型           | 大小   | 速度 | 准确度     | 推荐场景       |
| -------------- | ------ | ---- | ---------- | -------------- |
| tiny           | 39MB   | 最快 | ⭐⭐       | 测试           |
| **base** | 74MB   | 快   | ⭐⭐⭐⭐   | **推荐** |
| small          | 244MB  | 中等 | ⭐⭐⭐⭐   | 高质量         |
| medium         | 769MB  | 慢   | ⭐⭐⭐⭐⭐ | 专业           |
| large          | 1550MB | 很慢 | ⭐⭐⭐⭐⭐ | 最佳           |

### 字幕编辑

在CapCut中：

1. 点击字幕轨道查看所有字幕
2. 双击任意字幕片段编辑文本
3. 右键 → 字幕样式调整样式
4. 选择入场/出场动画

### 字幕时间调整

- 拖动字幕片段调整位置
- 拖动边缘调整显示时长
- 支持批量选择调整

## 🛠️ 故障排除

### 问题1：字幕识别失败

**原因**：Whisper未安装

**解决**：

```bash
pip3 install openai-whisper
```

### 问题2：字幕轨道不可见

**原因**：CapCut未刷新

**解决**：

1. 关闭CapCut
2. 重新运行脚本
3. 重新打开CapCut

### 问题3：字幕轨道不可见（但预览可见）

**原因**：轨道配置不正确（v3.0.5已修复）

**解决**：

- 使用v3.0.5或更高版本
- flag=1（AI识别）+ name="文字"

**诊断工具**（如仍有问题）：

```bash
python3 ANALYZE.py
```

### 问题3B：字幕轨道可见但看不到内容

**原因**：缺少words字段（v3.0.3已修复）

**解决**：

- 使用v3.0.3或更高版本
- words字段包含字幕的时间和文本信息

### 问题4：音频分段失败

**原因**：pydub未安装

**解决**：

```bash
pip3 install pydub
```

### 问题5：图片尺寸读取失败

**原因**：Pillow未安装

**解决**：

```bash
pip3 install pillow
```

## 📊 性能参考

- **音频处理**：约5秒/分钟音频
- **草稿生成**：约2秒
- **总耗时**：约10秒/分钟音频（已移除字幕识别，速度大幅提升）

## 🔄 版本历史

### v3.2.0 (2025-10-15) ✅ 当前版本 - 简化版本

- ✅ **移除Whisper字幕功能**
  - 移除openai-whisper依赖
  - 移除所有字幕相关代码和配置
  - 减小程序体积，提高运行速度
  - 推荐使用CapCut内置「智能字幕」功能
- ✅ **核心功能保留**
  - 音频智能分段✅
  - 图片智能分配✅
  - 震动特效✅
  - 背景模糊✅
  - 素材导入✅

### v3.1.1 (2025-10-15)

- ✅ 修复"取消选定区域"问题
- ✅ 回滚text segment错误修改
- ⚠️  字幕功能存在显示问题

### v3.1.0 (2025-10-15) - 已回滚

- ❌ 引入了"取消选定区域"问题

### v3.0.5 (2025-10-15)

- ✅ 修复字幕轨道不可见问题
  - flag改为1（AI识别标志）
  - name改为"文字"
- ✅ 字幕轨道位置优化

### v3.0.4 (2025-10-15)

- ✅ 添加duration和start_time字段到字幕材料
- ✅ 确保words字段时间为整数微秒格式
- ✅ 完全对齐1012草稿的字幕材料结构

### v3.0.3 (2025-10-15)

- ✅ 修复字幕内容显示问题（添加words字段）
- ✅ 添加letter_spacing字段
- ✅ 完善caption_info结构

### v3.0.2 (2025-10-15)

- ✨ 优化字幕轨道显示位置（audio后，时间线可见）
- ✅ 字幕轨道现在在CapCut时间线完全可见可编辑

### v3.0.1 (2025-10-15)

- ✨ 添加1012官方字幕样式
- ✅ 字幕样式完全对齐CapCut官方

### v3.0 (2025-10-15)

- ✨ 集成Whisper字幕识别
- ✨ 支持逐词弹出效果
- ✨ 完全自定义字幕样式

### v2.12 (2025-10-14)

- ✨ 修正震动特效参数映射
- ✅ 独立特效轨道

### v2.x

- 音频智能分段优化
- 智能图片分配
- 震动特效
- 背景模糊填充
- 开头音效

## 💡 使用技巧

### 1. 提高字幕准确度

- 使用更大的Whisper模型（small/medium）
- 确保音频清晰无杂音
- 正确设置语言参数

### 2. 优化音频处理

- 选择合适的消音模式（通常用模式3）
- 根据音频特点调整参数

### 3. 自定义字幕样式

```python
# 创建自己的样式
SUBTITLE_STYLES["我的样式"] = {
    "font_size": 18.0,
    "color": [1.0, 1.0, 0.0],  # 黄色
    "stroke_width": 0.4,
    ...
}
SUBTITLE_STYLE = "我的样式"
```

### 4. 批量处理

- 在素材目录准备多个项目文件夹
- 依次运行脚本处理每个项目

## 📚 相关资源

- **Whisper GitHub**: https://github.com/openai/whisper
- **CapCut官网**: https://www.capcut.com/
- **pydub文档**: https://github.com/jiaaro/pydub

## ⚠️ 注意事项

1. **首次使用Whisper**：首次运行会下载模型（base约74MB），需要1-2分钟
2. **音频格式**：支持mp3/wav/m4a等常见格式
3. **图片格式**：支持png/jpg/jpeg
4. **CapCut版本**：建议使用最新版本
5. **文件路径**：避免使用特殊字符和中文空格

## 🎓 学习资源

### 字幕识别

- Whisper使用 `word_timestamps=True` 获取单词级时间戳
- 支持99种语言
- 可自定义样式（颜色、字号、描边）

### CapCut草稿结构

- JSON格式存储
- materials：存放素材（音频、图片、字幕）
- tracks：存放轨道（video、audio、text、effect）
- 字幕通过materials.texts和text轨道关联

## 🤝 贡献

如有问题或建议，欢迎反馈！

## 📄 许可

MIT License

---

**版本**: v3.2.0  
**日期**: 2025-10-15  
**主程序**: `auto_capcut_draft_enhanced.py`

**核心功能**：音频智能分段 + 图片智能分配 + 画面特效 = 完整视频草稿 ✨

**v3.2.0更新**：
- ✅ 移除Whisper字幕功能（减小体积，提高速度）
- ✅ 核心功能完整保留（音频、图片、特效）
- ✅ 素材导入功能正常
- 📝 字幕请使用CapCut内置「智能字幕」功能

**字幕使用方法**：
打开草稿 → 点击「文字」→「智能字幕」→ 选择语言 → 开始识别
