# 震动特效参数映射完整分析 v2.12

## 🔍 问题发现过程

### 从截图看到的问题
您打开草稿后看到：
- **速度**: 20
- **强度**: 50

但您期望看到：
- **速度**: 2
- **强度**: 5

## 📊 参数映射关系分析

### 1. UI范围确认
通过对比您手动设置的草稿 `1015 带小狗_副本_091844` 发现：

```
UI显示范围: 0-100 （不是0-10）
```

### 2. 映射公式对比

| 草稿版本 | intensity JSON值 | UI显示强度 | speed JSON值 | UI显示速度 | 公式 |
|---------|-----------------|----------|-------------|----------|------|
| 手动设置草稿 | 0.5 | 50 | 0.2 | 20 | JSON × 100 |
| v2.11生成 | 0.5 | 50 | 0.2 | 20 | UI ÷ 10 ❌ |
| v2.12修正 | 0.05 | 5 | 0.02 | 2 | UI ÷ 100 ✅ |

### 3. 正确的映射公式

```
✅ JSON值 = UI值 ÷ 100
✅ UI值 = JSON值 × 100
```

示例：
- UI强度 5 → JSON: 5 ÷ 100 = **0.05**
- UI速度 2 → JSON: 2 ÷ 100 = **0.02**

## 🔧 v2.12 关键修复

### 修复1: 参数计算公式

**之前（v2.11）**:
```python
"value": SHAKE_INTENSITY / 10.0  # 5 ÷ 10 = 0.5 ❌ UI显示50
"value": SHAKE_SPEED / 10.0      # 2 ÷ 10 = 0.2 ❌ UI显示20
```

**修正后（v2.12）**:
```python
"value": SHAKE_INTENSITY / 100.0  # 5 ÷ 100 = 0.05 ✅ UI显示5
"value": SHAKE_SPEED / 100.0      # 2 ÷ 100 = 0.02 ✅ UI显示2
```

### 修复2: 特效路径

**之前**:
```python
"path": ""  # 空路径可能导致CapCut无法加载特效
```

**修正后**:
```python
"path": "/Users/mac/Library/Containers/com.lemon.lvoverseas/Data/Movies/CapCut/User Data/Cache/effect/7399470393884527877/d11532bfbfbd6f9af59026c2c42f2570"
```

## 📋 完整的震动特效JSON结构

```json
{
  "adjust_params": [
    {
      "default_value": 0.5,
      "name": "effects_adjust_intensity",
      "value": 0.05  // UI强度5
    },
    {
      "default_value": 0.33,
      "name": "effects_adjust_speed",
      "value": 0.02  // UI速度2
    }
  ],
  "category_id": "100000",
  "category_name": "画面特效",
  "effect_id": "7399470393884527877",
  "id": "生成的UUID",
  "name": "震动",
  "path": "/Users/mac/Library/Containers/com.lemon.lvoverseas/Data/Movies/CapCut/User Data/Cache/effect/7399470393884527877/d11532bfbfbd6f9af59026c2c42f2570",
  "type": "video_effect",
  ...
}
```

## 🎯 配置文件设置

在 `auto_capcut_draft_enhanced.py` 顶部：

```python
# 画面特效配置
ENABLE_SHAKE_EFFECT = True  # 是否启用震动特效
SHAKE_SPEED = 2.0           # 震动速度 (0-100)，UI会显示2
SHAKE_INTENSITY = 5.0       # 震动强度 (0-100)，UI会显示5
```

## ✅ 验证步骤

1. **运行脚本生成草稿** (v2.12+)
2. **在CapCut中打开草稿**
3. **点击特效轨道**，查看右侧面板
4. **确认参数**:
   - 速度滑块应该在 **2** 的位置
   - 强度滑块应该在 **5** 的位置

## 🆚 对比表

| 参数类型 | 配置值 | v2.11 JSON | v2.11 UI显示 | v2.12 JSON | v2.12 UI显示 |
|---------|--------|-----------|-------------|-----------|-------------|
| 强度 | 5.0 | 0.5 | ❌ 50 | 0.05 | ✅ 5 |
| 速度 | 2.0 | 0.2 | ❌ 20 | 0.02 | ✅ 2 |

## 🎨 特效轨道结构

```
轨道类型: effect
├─ 片段1
   ├─ material_id: 指向 video_effects 中的震动特效ID
   ├─ target_timerange: {start: 0, duration: 整个视频时长}
   └─ visible: true
```

## 📝 测试建议

由于v2.12脚本在复制音频时有个小bug，建议：

### 方案1: 手动修改现有草稿
修改 `1015 带小狗_副本_092625/draft_info.json`:

```bash
cd ~/Movies/CapCut/User\ Data/Projects/com.lveditor.draft/"1015 带小狗_副本_092625"

# 备份
cp draft_info.json draft_info.json.backup

# 修改（使用文本编辑器）
# 找到 video_effects 中的震动特效
# 将 intensity 的 value 从 0.5 改为 0.05
# 将 speed 的 value 从 0.2 改为 0.02
```

### 方案2: 修复脚本bug后重新生成
等待脚本bug修复后重新运行。

## 🎊 预期效果

修正后，在CapCut中：
1. ✅ 特效轨道正常显示
2. ✅ 播放时画面有细微震动（强度5，速度2的效果）
3. ✅ 参数可以手动调整

---

**版本**: v2.12  
**日期**: 2025-10-15  
**状态**: ✅ 参数映射已修正，待验证

