# æ–¹æ¡ˆ Bï¼šåŠè‡ªåŠ¨åŒ–å‰ªæ˜ è‰ç¨¿ç”Ÿæˆæ–¹æ¡ˆ

## ğŸ“‹ æ–¹æ¡ˆå®šä½

**æ ¸å¿ƒç†å¿µï¼šè‡ªåŠ¨åŒ– + äººå·¥ç²¾ä¿® = æœ€ä½³æ•ˆæœ**

```
æ–¹æ¡ˆ Aï¼ˆå…¨è‡ªåŠ¨ï¼‰      æ–¹æ¡ˆ Bï¼ˆåŠè‡ªåŠ¨ï¼‰         æ‰‹åŠ¨å‰ªè¾‘
    â†“                     â†“                      â†“
å¿«é€Ÿä½†å›ºå®š     â†â†’  çµæ´»å¯è°ƒæ•´  â†â†’        è´¹æ—¶ä½†å®Œç¾
```

### ä¸ºä»€ä¹ˆé€‰æ‹©æ–¹æ¡ˆ Bï¼Ÿ

âœ… **ä¿ç•™æ–¹æ¡ˆ A çš„ä¼˜ç‚¹ï¼š**
- è‡ªåŠ¨ç§»é™¤é™éŸ³
- è‡ªåŠ¨è¯­éŸ³è¯†åˆ«
- æ™ºèƒ½å›¾ç‰‡åˆ†é…é€»è¾‘
- æ‰¹é‡å¤„ç†èƒ½åŠ›

âœ… **å¢åŠ äººå·¥å¹²é¢„èƒ½åŠ›ï¼š**
- å¯åœ¨å‰ªæ˜ ä¸­è°ƒæ•´å›¾ç‰‡æ—¶é•¿
- å¯æ‰‹åŠ¨å¾®è°ƒå­—å¹•
- å¯æ·»åŠ è½¬åœºå’Œç‰¹æ•ˆ
- å¯è°ƒæ•´é…éŸ³éŸ³é‡
- å¯äºŒæ¬¡è°ƒè‰²å’Œç¾åŒ–

---

## ğŸ¯ å·¥ä½œæµç¨‹

### å®Œæ•´æµç¨‹å›¾

```
è¾“å…¥éŸ³é¢‘ï¼ˆå«é—´éš™ï¼‰
    â†“
[è‡ªåŠ¨] æ­¥éª¤1: ç§»é™¤é™éŸ³ â†’ clean_audio.mp3
    â†“
[äººå·¥æ£€æŸ¥ç‚¹ â‘ ] è¯•å¬å¤„ç†åéŸ³é¢‘ï¼Œç¡®è®¤æ•ˆæœ
    â†“
[è‡ªåŠ¨] æ­¥éª¤2: è¯­éŸ³è¯†åˆ« â†’ subtitles.srt
    â†“
[äººå·¥æ£€æŸ¥ç‚¹ â‘¡] æ£€æŸ¥å­—å¹•å‡†ç¡®æ€§ï¼Œæ‰‹åŠ¨ä¿®æ­£
    â†“
[è‡ªåŠ¨] æ­¥éª¤3: ç”Ÿæˆå‰ªæ˜ è‰ç¨¿ â†’ JianyingPro Drafts/
    â†“
[äººå·¥æ£€æŸ¥ç‚¹ â‘¢] åœ¨å‰ªæ˜ ä¸­æ‰“å¼€è‰ç¨¿
    â†“
[äººå·¥] æ­¥éª¤4: å‰ªæ˜ ä¸­ç²¾ä¿®
    â”œâ”€ è°ƒæ•´å›¾ç‰‡æ—¶é•¿å’Œä½ç½®
    â”œâ”€ ä¿®æ”¹å­—å¹•æ ·å¼
    â”œâ”€ æ·»åŠ è½¬åœºæ•ˆæœ
    â”œâ”€ è°ƒæ•´éŸ³é‡å’Œæ»¤é•œ
    â””â”€ æ·»åŠ èƒŒæ™¯éŸ³ä¹
    â†“
[äººå·¥] æ­¥éª¤5: å¯¼å‡ºæœ€ç»ˆè§†é¢‘ â†’ final.mp4
```

---

## ğŸ’¡ æ–¹æ¡ˆ B çš„æ ¸å¿ƒä¼˜åŠ¿

### å¯¹æ¯”ä¸‰ç§æ–¹æ¡ˆ

| ç‰¹æ€§ | æ–¹æ¡ˆAï¼ˆå…¨è‡ªåŠ¨ï¼‰ | æ–¹æ¡ˆBï¼ˆåŠè‡ªåŠ¨ï¼‰â­ | æ‰‹åŠ¨å‰ªè¾‘ |
|------|----------------|------------------|---------|
| **é€Ÿåº¦** | â­â­â­â­â­ | â­â­â­â­ | â­ |
| **çµæ´»æ€§** | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **è´¨é‡** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **å¯è°ƒæ•´æ€§** | âŒ | âœ… å¼º | âœ… å®Œå…¨ |
| **æ‰¹é‡å¤„ç†** | âœ… | âœ… | âŒ |
| **å­¦ä¹ æˆæœ¬** | ä½ | ä¸­ | ä½ |
| **é€‚åˆåœºæ™¯** | å¿«é€Ÿæµ‹è¯• | **ç”Ÿäº§ç¯å¢ƒ** | å•ä¸ªç²¾å“ |

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ¶æ„è®¾è®¡

```
æŠ€æœ¯æ ˆï¼š
â”œâ”€â”€ Python è‡ªåŠ¨åŒ–å±‚
â”‚   â”œâ”€â”€ pydub (éŸ³é¢‘å¤„ç†)
â”‚   â”œâ”€â”€ whisper (è¯­éŸ³è¯†åˆ«)
â”‚   â””â”€â”€ æ™ºèƒ½åˆ†é…ç®—æ³•
â”œâ”€â”€ å‰ªæ˜ è‰ç¨¿ç”Ÿæˆå±‚
â”‚   â”œâ”€â”€ JSON æ ¼å¼è‰ç¨¿
â”‚   â”œâ”€â”€ æ—¶é—´è½´ç²¾ç¡®å¯¹é½
â”‚   â””â”€â”€ ææ–™è‡ªåŠ¨å¯¼å…¥
â””â”€â”€ å‰ªæ˜ æ‰‹åŠ¨ç²¾ä¿®å±‚
    â”œâ”€â”€ å¯è§†åŒ–ç¼–è¾‘
    â”œâ”€â”€ ç‰¹æ•ˆå’Œè½¬åœº
    â””â”€â”€ æœ€ç»ˆå¯¼å‡º
```

---

## ğŸ“¦ å®Œæ•´ä»£ç å®ç°

### ä¸»ç¨‹åºï¼š`semi_auto_generator.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æ–¹æ¡ˆ Bï¼šåŠè‡ªåŠ¨åŒ–å‰ªæ˜ è‰ç¨¿ç”Ÿæˆå™¨
ç»“åˆæ–¹æ¡ˆ A çš„æ™ºèƒ½é€»è¾‘ + å‰ªæ˜ çš„å¯è§†åŒ–ç¼–è¾‘èƒ½åŠ›
"""

import json
import os
import uuid
import shutil
import glob
import re
from typing import List, Dict, Tuple
from pydub import AudioSegment
from pydub.silence import detect_nonsilent
import whisper
from mutagen import File as MutagenFile

# ============================================================================
# å·¥å…·å‡½æ•°ï¼ˆç»§æ‰¿è‡ª zidongjianji.py å’Œæ–¹æ¡ˆ Aï¼‰
# ============================================================================

def generate_uuid() -> str:
    """ç”ŸæˆUUID"""
    return str(uuid.uuid4()).upper()


def natural_sort_key(filename: str) -> tuple:
    """è‡ªç„¶æ’åºé”®å‡½æ•°"""
    parts = re.findall(r'(\d+)', filename)
    return tuple(int(part) for part in parts)


def get_audio_duration_accurate(audio_file: str) -> int:
    """
    è·å–éŸ³é¢‘æ–‡ä»¶çš„å‡†ç¡®æ—¶é•¿ï¼ˆå¾®ç§’ï¼‰
    ç”¨äºå‰ªæ˜ è‰ç¨¿çš„ç²¾ç¡®æ—¶é—´è½´å¯¹é½
    """
    try:
        audio = MutagenFile(audio_file)
        if audio is not None and hasattr(audio, 'info') and hasattr(audio.info, 'length'):
            duration_seconds = audio.info.length
            return int(duration_seconds * 1000000)  # è½¬æ¢ä¸ºå¾®ç§’
        else:
            print(f"âš ï¸  æ— æ³•è¯»å–éŸ³é¢‘æ—¶é•¿: {os.path.basename(audio_file)}")
            return 3000000  # é»˜è®¤3ç§’
    except Exception as e:
        print(f"âš ï¸  è¯»å–éŸ³é¢‘æ—¶é•¿å‡ºé”™: {e}")
        return 3000000


# ============================================================================
# æ­¥éª¤ 1: éŸ³é¢‘é¢„å¤„ç†ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
# ============================================================================

def remove_silence_step(
    input_audio: str,
    output_audio: str,
    min_silence_len: int = 500,
    silence_thresh: int = -40
) -> str:
    """
    æ­¥éª¤1ï¼šç§»é™¤éŸ³é¢‘é™éŸ³ç‰‡æ®µ
    
    äººå·¥æ£€æŸ¥ç‚¹ï¼šå¤„ç†å®Œæˆåï¼Œè¯•å¬ output_audio ç¡®è®¤æ•ˆæœ
    
    Args:
        input_audio: åŸå§‹éŸ³é¢‘è·¯å¾„
        output_audio: è¾“å‡ºéŸ³é¢‘è·¯å¾„
        min_silence_len: æœ€å°é™éŸ³é•¿åº¦ï¼ˆæ¯«ç§’ï¼‰
        silence_thresh: é™éŸ³é˜ˆå€¼ï¼ˆdBï¼‰
        
    Returns:
        å¤„ç†åçš„éŸ³é¢‘è·¯å¾„
    """
    print("\n" + "="*60)
    print("ğŸ“ æ­¥éª¤ 1/5: ç§»é™¤éŸ³é¢‘é™éŸ³ç‰‡æ®µ")
    print("="*60)
    
    audio = AudioSegment.from_file(input_audio)
    original_duration = len(audio) / 1000
    
    print(f"åŸå§‹éŸ³é¢‘æ—¶é•¿: {original_duration:.2f}ç§’")
    print(f"æ£€æµ‹å‚æ•°: é™éŸ³>{min_silence_len}ms, éŸ³é‡<{silence_thresh}dB")
    
    nonsilent_ranges = detect_nonsilent(
        audio,
        min_silence_len=min_silence_len,
        silence_thresh=silence_thresh,
        seek_step=10
    )
    
    output = AudioSegment.empty()
    for start, end in nonsilent_ranges:
        output += audio[start:end]
    
    output.export(output_audio, format="mp3")
    
    new_duration = len(output) / 1000
    removed_duration = original_duration - new_duration
    
    print(f"âœ… å¤„ç†å®Œæˆ")
    print(f"   æ–°æ—¶é•¿: {new_duration:.2f}ç§’")
    print(f"   ç§»é™¤: {removed_duration:.2f}ç§’ ({removed_duration/original_duration*100:.1f}%)")
    print(f"   è¾“å‡ºæ–‡ä»¶: {output_audio}")
    
    print("\nğŸ” äººå·¥æ£€æŸ¥ç‚¹ â‘ :")
    print("   è¯·è¯•å¬å¤„ç†åçš„éŸ³é¢‘ï¼Œç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š")
    print("   1. é™éŸ³ç§»é™¤æ˜¯å¦åˆé€‚ï¼ˆä¸è¦åˆ é™¤å¤ªå¤šåœé¡¿ï¼‰")
    print("   2. éŸ³é¢‘æ˜¯å¦è¿è´¯è‡ªç„¶")
    print("   3. å¦‚éœ€è°ƒæ•´ï¼Œä¿®æ”¹å‚æ•°åé‡æ–°è¿è¡Œ")
    input("   ç¡®è®¤æ— è¯¯åæŒ‰ Enter ç»§ç»­...\n")
    
    return output_audio


# ============================================================================
# æ­¥éª¤ 2: è¯­éŸ³è¯†åˆ«ï¼ˆè‡ªåŠ¨åŒ– + äººå·¥æ ¡å¯¹ï¼‰
# ============================================================================

def transcribe_audio_step(
    audio_path: str,
    srt_path: str,
    model_size: str = "base"
) -> List[dict]:
    """
    æ­¥éª¤2ï¼šä½¿ç”¨ Whisper è¯†åˆ«è‹±æ–‡å¹¶ç”Ÿæˆå­—å¹•
    
    äººå·¥æ£€æŸ¥ç‚¹ï¼šè¯†åˆ«å®Œæˆåï¼Œæ£€æŸ¥å­—å¹•å‡†ç¡®æ€§
    
    Args:
        audio_path: éŸ³é¢‘æ–‡ä»¶è·¯å¾„
        srt_path: è¾“å‡º SRT æ–‡ä»¶è·¯å¾„
        model_size: Whisper æ¨¡å‹å¤§å°
        
    Returns:
        å­—å¹•ç‰‡æ®µåˆ—è¡¨
    """
    print("\n" + "="*60)
    print("ğŸ“ æ­¥éª¤ 2/5: è¯­éŸ³è¯†åˆ«å¹¶ç”Ÿæˆå­—å¹•")
    print("="*60)
    
    print(f"åŠ è½½ Whisper æ¨¡å‹: {model_size}")
    model = whisper.load_model(model_size)
    
    print("æ­£åœ¨è¯†åˆ«è¯­éŸ³...")
    result = model.transcribe(audio_path, language="en", verbose=False)
    
    # ç”Ÿæˆ SRT å­—å¹•
    with open(srt_path, "w", encoding="utf-8") as f:
        for i, segment in enumerate(result['segments'], 1):
            start = format_timestamp(segment['start'])
            end = format_timestamp(segment['end'])
            text = segment['text'].strip()
            
            f.write(f"{i}\n")
            f.write(f"{start} --> {end}\n")
            f.write(f"{text}\n\n")
    
    print(f"âœ… è¯†åˆ«å®Œæˆ")
    print(f"   è¯†åˆ«åˆ° {len(result['segments'])} ä¸ªå¥å­")
    print(f"   å­—å¹•æ–‡ä»¶: {srt_path}")
    
    # æ˜¾ç¤ºå‰å‡ å¥å­—å¹•
    print("\nå‰3å¥å­—å¹•é¢„è§ˆ:")
    for i, segment in enumerate(result['segments'][:3], 1):
        print(f"   {i}. [{segment['start']:.2f}s - {segment['end']:.2f}s]")
        print(f"      {segment['text']}")
    
    print("\nğŸ” äººå·¥æ£€æŸ¥ç‚¹ â‘¡:")
    print("   è¯·æ£€æŸ¥å­—å¹•æ–‡ä»¶ï¼Œç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š")
    print("   1. æ–‡å­—è¯†åˆ«æ˜¯å¦å‡†ç¡®")
    print("   2. æ—¶é—´è½´æ˜¯å¦å¯¹é½")
    print("   3. å¦‚æœ‰é”™è¯¯ï¼Œæ‰‹åŠ¨ç¼–è¾‘ SRT æ–‡ä»¶ä¿®æ­£")
    print(f"   å­—å¹•æ–‡ä»¶è·¯å¾„: {srt_path}")
    input("   ç¡®è®¤æ— è¯¯åæŒ‰ Enter ç»§ç»­...\n")
    
    return result['segments']


def format_timestamp(seconds: float) -> str:
    """è½¬æ¢ä¸º SRT æ—¶é—´æ ¼å¼"""
    hours = int(seconds // 3600)
    minutes = int((seconds % 3600) // 60)
    secs = int(seconds % 60)
    millis = int((seconds % 1) * 1000)
    return f"{hours:02d}:{minutes:02d}:{secs:02d},{millis:03d}"


# ============================================================================
# æ­¥éª¤ 3: ç”Ÿæˆå‰ªæ˜ è‰ç¨¿ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
# ============================================================================

def create_jianying_draft_step(
    template_path: str,
    clean_audio: str,
    image_folder: str,
    segments: List[dict],
    output_folder: str,
    draft_name: str = "auto_draft",
    duration_threshold: float = 1.5
) -> str:
    """
    æ­¥éª¤3ï¼šç”Ÿæˆå‰ªæ˜ è‰ç¨¿
    
    èåˆ zidongjianji.py çš„è‰ç¨¿ç”Ÿæˆèƒ½åŠ› + æ–¹æ¡ˆAçš„æ™ºèƒ½åˆ†é…é€»è¾‘
    
    Args:
        template_path: æ¨¡æ¿è‰ç¨¿æ–‡ä»¶è·¯å¾„
        clean_audio: å¤„ç†åçš„éŸ³é¢‘è·¯å¾„
        image_folder: å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„
        segments: è¯­éŸ³è¯†åˆ«çš„ç‰‡æ®µåˆ—è¡¨
        output_folder: è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„
        draft_name: è‰ç¨¿åç§°
        duration_threshold: çŸ­/é•¿éŸ³é¢‘é˜ˆå€¼ï¼ˆç§’ï¼‰
        
    Returns:
        è‰ç¨¿æ–‡ä»¶å¤¹è·¯å¾„
    """
    print("\n" + "="*60)
    print("ğŸ“ æ­¥éª¤ 3/5: ç”Ÿæˆå‰ªæ˜ è‰ç¨¿")
    print("="*60)
    
    # è¯»å–æ¨¡æ¿
    with open(template_path, 'r', encoding='utf-8') as f:
        draft = json.load(f)
    
    # åˆ›å»ºè¾“å‡ºæ–‡ä»¶å¤¹
    draft_folder = os.path.join(output_folder, draft_name)
    os.makedirs(draft_folder, exist_ok=True)
    
    # è·å–å›¾ç‰‡åˆ—è¡¨å¹¶æ’åº
    image_files = []
    for ext in ['*.png', '*.jpg', '*.jpeg', '*.PNG', '*.JPG', '*.JPEG']:
        image_files.extend(glob.glob(os.path.join(image_folder, ext)))
    
    if not image_files:
        raise ValueError(f"âŒ åœ¨ {image_folder} ä¸­æœªæ‰¾åˆ°å›¾ç‰‡æ–‡ä»¶ï¼")
    
    image_files.sort(key=lambda x: natural_sort_key(os.path.basename(x)))
    
    print(f"æ‰¾åˆ° {len(image_files)} å¼ å›¾ç‰‡")
    print(f"è¯†åˆ«åˆ° {len(segments)} ä¸ªå¥å­")
    
    # ä¿ç•™åŸæœ‰çš„åŸºç¡€ææ–™
    original_audios = [audio for audio in draft['materials']['audios'] 
                      if audio.get('name') == 'messironaldo.MP3']
    original_videos = [video for video in draft['materials']['videos'] 
                      if video.get('material_name') in ['black.png', '173874-850026348_small.mp4']]
    
    # é‡ç½®ææ–™åˆ—è¡¨
    draft['materials']['audios'] = original_audios
    draft['materials']['videos'] = original_videos
    
    # æ¸…ç©ºç¬¬ä¸€ä¸ªè§†é¢‘è½¨é“
    for track in draft['tracks']:
        if track['type'] == 'video' and track.get('flag', 0) == 0:
            track['segments'] = []
            break
    
    # ========== æ·»åŠ å¤„ç†åçš„éŸ³é¢‘ææ–™ ==========
    audio_duration = get_audio_duration_accurate(clean_audio)
    audio_id = generate_uuid()
    
    audio_material = {
        "app_id": 0,
        "category_id": "",
        "category_name": "",
        "check_flag": 1,
        "duration": audio_duration,
        "id": audio_id,
        "name": os.path.basename(clean_audio),
        "path": clean_audio,
        "type": "extract_music",
        "wave_points": []
    }
    
    draft['materials']['audios'].append(audio_material)
    print(f"âœ… æ·»åŠ éŸ³é¢‘: {os.path.basename(clean_audio)} ({audio_duration/1000000:.2f}ç§’)")
    
    # ========== æ·»åŠ å›¾ç‰‡ææ–™ ==========
    image_ids = []
    for image_file in image_files:
        image_id = generate_uuid()
        
        image_material = {
            "aigc_type": "none",
            "category_id": "",
            "check_flag": 63487,
            "crop": {
                "lower_left_x": 0.0, "lower_left_y": 1.0,
                "lower_right_x": 1.0, "lower_right_y": 1.0,
                "upper_left_x": 0.0, "upper_left_y": 0.0,
                "upper_right_x": 1.0, "upper_right_y": 0.0
            },
            "duration": 10800000000,
            "has_audio": False,
            "height": 2048,
            "width": 1152,
            "id": image_id,
            "material_name": os.path.basename(image_file),
            "path": image_file,
            "type": "photo"
        }
        
        draft['materials']['videos'].append(image_material)
        image_ids.append(image_id)
    
    print(f"âœ… æ·»åŠ  {len(image_ids)} å¼ å›¾ç‰‡")
    
    # ========== æ™ºèƒ½åˆ†é…å›¾ç‰‡åˆ°æ—¶é—´è½´ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰==========
    print(f"\n=== æ™ºèƒ½å›¾ç‰‡åˆ†é…ï¼ˆé˜ˆå€¼: {duration_threshold}ç§’ï¼‰===")
    
    video_track = None
    for track in draft['tracks']:
        if track['type'] == 'video' and track.get('flag', 0) == 0:
            video_track = track
            break
    
    if not video_track:
        raise ValueError("âŒ æœªæ‰¾åˆ°è§†é¢‘è½¨é“")
    
    image_index = 0
    
    for i, segment in enumerate(segments):
        start_time_micro = int(segment['start'] * 1000000)
        end_time_micro = int(segment['end'] * 1000000)
        duration_micro = end_time_micro - start_time_micro
        duration_sec = duration_micro / 1000000
        
        if duration_sec < duration_threshold:
            # ========== çŸ­éŸ³é¢‘ï¼š1å¼ å›¾ç‰‡ ==========
            if image_index < len(image_ids):
                segment_json = create_video_segment(
                    material_id=image_ids[image_index],
                    start_time=start_time_micro,
                    duration=duration_micro,
                    render_index=len(video_track['segments']) + 1
                )
                
                video_track['segments'].append(segment_json)
                print(f"å¥å­ {i+1} (çŸ­ {duration_sec:.2f}s): å›¾ç‰‡ {image_index+1}")
                image_index += 1
        else:
            # ========== é•¿éŸ³é¢‘ï¼š2å¼ å›¾ç‰‡ ==========
            if image_index + 1 < len(image_ids):
                half_duration = duration_micro // 2
                
                # ç¬¬ä¸€å¼ å›¾ç‰‡
                seg1 = create_video_segment(
                    material_id=image_ids[image_index],
                    start_time=start_time_micro,
                    duration=half_duration,
                    render_index=len(video_track['segments']) + 1
                )
                video_track['segments'].append(seg1)
                
                # ç¬¬äºŒå¼ å›¾ç‰‡
                seg2 = create_video_segment(
                    material_id=image_ids[image_index + 1],
                    start_time=start_time_micro + half_duration,
                    duration=duration_micro - half_duration,
                    render_index=len(video_track['segments']) + 2
                )
                video_track['segments'].append(seg2)
                
                print(f"å¥å­ {i+1} (é•¿ {duration_sec:.2f}s): å›¾ç‰‡ {image_index+1} + {image_index+2}")
                image_index += 2
    
    print(f"\nğŸ“Š å›¾ç‰‡ä½¿ç”¨ç»Ÿè®¡:")
    print(f"   æ€»å›¾ç‰‡: {len(image_ids)}")
    print(f"   å·²ä½¿ç”¨: {image_index}")
    print(f"   æœªä½¿ç”¨: {len(image_ids) - image_index}")
    
    # ========== åˆ›å»ºéŸ³é¢‘è½¨é“ ==========
    audio_track_id = generate_uuid()
    audio_segment = {
        "id": generate_uuid(),
        "material_id": audio_id,
        "source_timerange": {"duration": audio_duration, "start": 0},
        "target_timerange": {"duration": audio_duration, "start": 0},
        "volume": 10.0,  # +20dB å¯¹ç™½éŸ³é‡
        "visible": True,
        "speed": 1.0
    }
    
    audio_track = {
        "attribute": 0,
        "flag": 0,
        "id": audio_track_id,
        "is_default_name": True,
        "name": "",
        "segments": [audio_segment],
        "type": "audio"
    }
    
    draft['tracks'].append(audio_track)
    
    # æ›´æ–°æ€»æ—¶é•¿
    draft['duration'] = audio_duration
    
    print(f"âœ… åˆ›å»ºéŸ³é¢‘è½¨é“")
    
    # ========== è°ƒæ•´èƒŒæ™¯éŸ³ä¹å’Œå…¶ä»–å…ƒç´  ==========
    adjust_background_elements(draft, audio_duration)
    
    # ä¿å­˜è‰ç¨¿æ–‡ä»¶
    draft_content_path = os.path.join(draft_folder, "draft_content.json")
    with open(draft_content_path, 'w', encoding='utf-8') as f:
        json.dump(draft, f, ensure_ascii=False, indent=2)
    
    # å¤åˆ¶æ¨¡æ¿æ–‡ä»¶å¤¹çš„å…¶ä»–æ–‡ä»¶
    template_folder = os.path.dirname(template_path)
    for item in os.listdir(template_folder):
        if item != "draft_content.json":
            src_path = os.path.join(template_folder, item)
            dst_path = os.path.join(draft_folder, item)
            
            try:
                if os.path.isfile(src_path):
                    shutil.copy2(src_path, dst_path)
                elif os.path.isdir(src_path):
                    if os.path.exists(dst_path):
                        shutil.rmtree(dst_path)
                    shutil.copytree(src_path, dst_path)
            except Exception as e:
                print(f"âš ï¸  å¤åˆ¶æ–‡ä»¶æ—¶å‡ºé”™ {item}: {e}")
    
    print(f"\nâœ… å‰ªæ˜ è‰ç¨¿ç”Ÿæˆå®Œæˆ")
    print(f"   è‰ç¨¿è·¯å¾„: {draft_folder}")
    print(f"   æ€»æ—¶é•¿: {audio_duration/1000000:.2f}ç§’")
    
    return draft_folder


def create_video_segment(material_id: str, start_time: int, duration: int, render_index: int) -> dict:
    """åˆ›å»ºè§†é¢‘ç‰‡æ®µ JSON"""
    return {
        "caption_info": None,
        "cartoon": False,
        "clip": {
            "alpha": 1.0,
            "flip": {"horizontal": False, "vertical": False},
            "rotation": 0.0,
            "scale": {"x": 1.0, "y": 1.0},
            "transform": {"x": 0.0, "y": 0.0}
        },
        "common_keyframes": [],
        "enable_adjust": True,
        "extra_material_refs": [],
        "id": generate_uuid(),
        "material_id": material_id,
        "render_index": render_index,
        "source_timerange": {"duration": duration, "start": 0},
        "speed": 1.0,
        "target_timerange": {"duration": duration, "start": start_time},
        "visible": True,
        "volume": 1.0
    }


def adjust_background_elements(draft: dict, total_duration: int):
    """è°ƒæ•´èƒŒæ™¯éŸ³ä¹ã€é»‘è‰²èƒŒæ™¯ç­‰å…ƒç´ çš„æ—¶é•¿"""
    for track in draft['tracks']:
        if track['type'] == 'audio':
            for segment in track['segments']:
                if 'material_id' in segment:
                    for audio_material in draft['materials']['audios']:
                        if (audio_material['id'] == segment['material_id'] and 
                            audio_material.get('name') == 'messironaldo.MP3'):
                            segment['target_timerange']['duration'] = total_duration
                            if 'source_timerange' in segment:
                                segment['source_timerange']['duration'] = total_duration
                            segment['volume'] = 3.16  # +10dB èƒŒæ™¯éŸ³ä¹
                            print(f"âœ… è°ƒæ•´èƒŒæ™¯éŸ³ä¹åˆ° {total_duration/1000000:.2f}ç§’")
        
        if track['type'] == 'video':
            for segment in track['segments']:
                if 'material_id' in segment:
                    for video_material in draft['materials']['videos']:
                        if video_material['id'] == segment['material_id']:
                            material_name = video_material.get('material_name', '')
                            if 'black.png' in material_name.lower():
                                segment['target_timerange']['duration'] = total_duration
                                if 'source_timerange' in segment:
                                    segment['source_timerange']['duration'] = total_duration


# ============================================================================
# æ­¥éª¤ 4: äººå·¥ç²¾ä¿®æŒ‡å¼•
# ============================================================================

def manual_editing_guide(draft_folder: str):
    """
    æ­¥éª¤4ï¼šäººå·¥ç²¾ä¿®æŒ‡å¼•
    
    æä¾›è¯¦ç»†çš„å‰ªæ˜ æ“ä½œæŒ‡å—
    """
    print("\n" + "="*60)
    print("ğŸ“ æ­¥éª¤ 4/5: åœ¨å‰ªæ˜ ä¸­ç²¾ä¿®")
    print("="*60)
    
    print("\nğŸ” äººå·¥æ£€æŸ¥ç‚¹ â‘¢:")
    print(f"   è‰ç¨¿å·²ç”Ÿæˆï¼Œè¯·åœ¨å‰ªæ˜ ä¸­æ‰“å¼€è¿›è¡Œç²¾ä¿®")
    print(f"   è‰ç¨¿è·¯å¾„: {draft_folder}")
    
    print("\nğŸ“ ç²¾ä¿®æ¸…å•ï¼ˆå»ºè®®æŒ‰é¡ºåºè¿›è¡Œï¼‰:")
    print("\n1ï¸âƒ£  æ£€æŸ¥æ—¶é—´è½´å¯¹é½")
    print("   â˜ å›¾ç‰‡åˆ‡æ¢æ—¶é—´æ˜¯å¦åˆç†")
    print("   â˜ éŸ³é¢‘æ˜¯å¦ä¸ç”»é¢åŒæ­¥")
    print("   â˜ è°ƒæ•´å›¾ç‰‡æ˜¾ç¤ºæ—¶é•¿ï¼ˆå¦‚éœ€è¦ï¼‰")
    
    print("\n2ï¸âƒ£  å­—å¹•ä¼˜åŒ–")
    print("   â˜ å¯¼å…¥ SRT å­—å¹•æ–‡ä»¶")
    print("   â˜ è°ƒæ•´å­—å¹•æ ·å¼ï¼ˆå­—ä½“ã€å¤§å°ã€é¢œè‰²ï¼‰")
    print("   â˜ æ·»åŠ å­—å¹•æè¾¹æˆ–é˜´å½±")
    print("   â˜ è°ƒæ•´å­—å¹•ä½ç½®")
    
    print("\n3ï¸âƒ£  è§†è§‰æ•ˆæœ")
    print("   â˜ æ·»åŠ å›¾ç‰‡è½¬åœºï¼ˆæ¨èï¼šå åŒ–ã€æ“¦é™¤ï¼‰")
    print("   â˜ æ·»åŠ å›¾ç‰‡åŠ¨ç”»ï¼ˆç¼©æ”¾ã€å¹³ç§»ï¼‰")
    print("   â˜ è°ƒæ•´ç”»é¢æ¯”ä¾‹ï¼ˆç¡®ä¿16:9ï¼‰")
    print("   â˜ æ·»åŠ æ»¤é•œæˆ–è°ƒè‰²")
    
    print("\n4ï¸âƒ£  éŸ³é¢‘ä¼˜åŒ–")
    print("   â˜ è°ƒæ•´å¯¹ç™½éŸ³é‡")
    print("   â˜ æ·»åŠ /è°ƒæ•´èƒŒæ™¯éŸ³ä¹")
    print("   â˜ æ·»åŠ éŸ³æ•ˆï¼ˆå¦‚éœ€è¦ï¼‰")
    print("   â˜ ä½¿ç”¨éŸ³é¢‘é™å™ª")
    
    print("\n5ï¸âƒ£  æœ€ç»ˆæ£€æŸ¥")
    print("   â˜ é¢„è§ˆå®Œæ•´è§†é¢‘")
    print("   â˜ æ£€æŸ¥æ˜¯å¦æœ‰å¡é¡¿æˆ–è·³å¸§")
    print("   â˜ ç¡®è®¤å­—å¹•æ— é®æŒ¡")
    print("   â˜ ç¡®è®¤éŸ³ç”»åŒæ­¥")
    
    print("\nğŸ’¡ å¿«æ·é”®æç¤º:")
    print("   ç©ºæ ¼é”®: æ’­æ”¾/æš‚åœ")
    print("   J/K/L: å€’é€€/æš‚åœ/å¿«è¿›")
    print("   Cmd+Z: æ’¤é”€")
    print("   Cmd+S: ä¿å­˜")
    
    input("\nå®Œæˆç²¾ä¿®åæŒ‰ Enter ç»§ç»­...\n")


# ============================================================================
# æ­¥éª¤ 5: å¯¼å‡ºæŒ‡å¼•
# ============================================================================

def export_guide():
    """
    æ­¥éª¤5ï¼šå¯¼å‡ºè§†é¢‘æŒ‡å¼•
    """
    print("\n" + "="*60)
    print("ğŸ“ æ­¥éª¤ 5/5: å¯¼å‡ºè§†é¢‘")
    print("="*60)
    
    print("\nğŸ“¤ å¯¼å‡ºè®¾ç½®å»ºè®®:")
    print("   åˆ†è¾¨ç‡: 1920x1080 (16:9)")
    print("   å¸§ç‡: 30fps")
    print("   ç ç‡: è‡ªåŠ¨æˆ– 5000kbps")
    print("   æ ¼å¼: MP4 (H.264)")
    
    print("\nâš™ï¸  å¯¼å‡ºæ­¥éª¤:")
    print("   1. ç‚¹å‡»å³ä¸Šè§’ã€Œå¯¼å‡ºã€æŒ‰é’®")
    print("   2. é€‰æ‹©å¯¼å‡ºåˆ†è¾¨ç‡ä¸º 1080P")
    print("   3. é€‰æ‹©å¯¼å‡ºæ ¼å¼ä¸º MP4")
    print("   4. è®¾ç½®å¯¼å‡ºè·¯å¾„")
    print("   5. ç‚¹å‡»ã€Œå¯¼å‡ºã€å¼€å§‹æ¸²æŸ“")
    
    print("\nâ±ï¸  é¢„è®¡å¯¼å‡ºæ—¶é—´:")
    print("   1åˆ†é’Ÿè§†é¢‘ â‰ˆ 1-3åˆ†é’Ÿæ¸²æŸ“æ—¶é—´ï¼ˆå–å†³äºç‰¹æ•ˆæ•°é‡ï¼‰")
    
    print("\nâœ… å®Œæˆï¼")


# ============================================================================
# ä¸»ç¨‹åºæµç¨‹
# ============================================================================

def semi_auto_workflow(
    input_audio: str,
    image_folder: str,
    template_path: str,
    output_base_folder: str,
    draft_name: str = "video_draft",
    jianying_drafts_folder: str = None,
    duration_threshold: float = 1.5,
    min_silence_len: int = 500,
    silence_thresh: int = -40,
    whisper_model: str = "base"
):
    """
    æ–¹æ¡ˆ Bï¼šåŠè‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹
    
    Args:
        input_audio: åŸå§‹éŸ³é¢‘è·¯å¾„
        image_folder: å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„
        template_path: å‰ªæ˜ æ¨¡æ¿è‰ç¨¿è·¯å¾„
        output_base_folder: ä¸´æ—¶è¾“å‡ºæ–‡ä»¶å¤¹
        draft_name: è‰ç¨¿åç§°
        jianying_drafts_folder: å‰ªæ˜ è‰ç¨¿æœ€ç»ˆç›®æ ‡æ–‡ä»¶å¤¹
        duration_threshold: çŸ­/é•¿éŸ³é¢‘é˜ˆå€¼ï¼ˆç§’ï¼‰
        min_silence_len: æœ€å°é™éŸ³é•¿åº¦ï¼ˆæ¯«ç§’ï¼‰
        silence_thresh: é™éŸ³é˜ˆå€¼ï¼ˆdBï¼‰
        whisper_model: Whisper æ¨¡å‹å¤§å°
    """
    print("\n" + "="*70)
    print("ğŸ¬ æ–¹æ¡ˆ Bï¼šåŠè‡ªåŠ¨åŒ–å‰ªæ˜ è‰ç¨¿ç”Ÿæˆå™¨")
    print("   ç»“åˆè‡ªåŠ¨åŒ–æ•ˆç‡ + äººå·¥ç²¾ä¿®è´¨é‡")
    print("="*70)
    
    # åˆ›å»ºä¸´æ—¶å·¥ä½œæ–‡ä»¶å¤¹
    os.makedirs(output_base_folder, exist_ok=True)
    
    # å®šä¹‰ä¸­é—´æ–‡ä»¶è·¯å¾„
    clean_audio = os.path.join(output_base_folder, "clean_audio.mp3")
    srt_path = os.path.join(output_base_folder, "subtitles.srt")
    
    # ========== æ­¥éª¤ 1: ç§»é™¤é™éŸ³ ==========
    clean_audio = remove_silence_step(
        input_audio=input_audio,
        output_audio=clean_audio,
        min_silence_len=min_silence_len,
        silence_thresh=silence_thresh
    )
    
    # ========== æ­¥éª¤ 2: è¯­éŸ³è¯†åˆ« ==========
    segments = transcribe_audio_step(
        audio_path=clean_audio,
        srt_path=srt_path,
        model_size=whisper_model
    )
    
    # ========== æ­¥éª¤ 3: ç”Ÿæˆå‰ªæ˜ è‰ç¨¿ ==========
    draft_folder = create_jianying_draft_step(
        template_path=template_path,
        clean_audio=clean_audio,
        image_folder=image_folder,
        segments=segments,
        output_folder=output_base_folder,
        draft_name=draft_name,
        duration_threshold=duration_threshold
    )
    
    # ç§»åŠ¨è‰ç¨¿åˆ°å‰ªæ˜ æ–‡ä»¶å¤¹ï¼ˆå¦‚æœæŒ‡å®šï¼‰
    if jianying_drafts_folder:
        final_draft_path = os.path.join(jianying_drafts_folder, draft_name)
        
        # å¦‚æœç›®æ ‡å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
        if os.path.exists(final_draft_path):
            shutil.rmtree(final_draft_path)
        
        # ç§»åŠ¨è‰ç¨¿
        shutil.move(draft_folder, final_draft_path)
        draft_folder = final_draft_path
        
        print(f"\nâœ… è‰ç¨¿å·²ç§»åŠ¨åˆ°å‰ªæ˜ æ–‡ä»¶å¤¹")
        print(f"   {final_draft_path}")
    
    # ========== æ­¥éª¤ 4: äººå·¥ç²¾ä¿®æŒ‡å¼• ==========
    manual_editing_guide(draft_folder)
    
    # ========== æ­¥éª¤ 5: å¯¼å‡ºæŒ‡å¼• ==========
    export_guide()
    
    print("\n" + "="*70)
    print("ğŸ‰ æ–¹æ¡ˆ B æµç¨‹å®Œæˆï¼")
    print("="*70)
    print(f"\nğŸ“ è¾“å‡ºæ–‡ä»¶:")
    print(f"   è‰ç¨¿: {draft_folder}")
    print(f"   å­—å¹•: {srt_path}")
    print(f"   éŸ³é¢‘: {clean_audio}")
    
    print("\nğŸ’¡ åç»­æ­¥éª¤:")
    print("   1. åœ¨å‰ªæ˜ ä¸­æ‰“å¼€è‰ç¨¿è¿›è¡Œç²¾ä¿®")
    print("   2. å®Œæˆåå¯¼å‡ºæœ€ç»ˆè§†é¢‘")
    print("   3. å¦‚éœ€æ‰¹é‡å¤„ç†ï¼Œé‡å¤è¿è¡Œè„šæœ¬")


# ============================================================================
# ä½¿ç”¨ç¤ºä¾‹
# ============================================================================

if __name__ == "__main__":
    # ========== é…ç½®è·¯å¾„ ==========
    
    # è¾“å…¥æ–‡ä»¶
    INPUT_AUDIO = "/Users/mac/YouTube/01å·¥å…·ç±»/playwright/input.mp3"
    IMAGE_FOLDER = "/Users/mac/YouTube/01å·¥å…·ç±»/playwright/reference_images/01"
    
    # å‰ªæ˜ æ¨¡æ¿ï¼ˆéœ€è¦æå‰åˆ›å»ºä¸€ä¸ªåŸºç¡€æ¨¡æ¿ï¼‰
    TEMPLATE_PATH = "/Users/mac/Desktop/template_draft/draft_content.json"
    
    # è¾“å‡ºè·¯å¾„
    OUTPUT_BASE_FOLDER = "/Users/mac/YouTube/01å·¥å…·ç±»/playwright/temp_output"
    JIANYING_DRAFTS_FOLDER = "/Users/mac/Movies/JianyingPro/User Data/Projects/com.lveditor.draft"
    
    # è‰ç¨¿åç§°ï¼ˆå»ºè®®ç”¨é¡¹ç›®åï¼‰
    DRAFT_NAME = "story_01"
    
    # ========== å¯è°ƒå‚æ•° ==========
    
    # çŸ­/é•¿éŸ³é¢‘é˜ˆå€¼ï¼ˆç§’ï¼‰
    DURATION_THRESHOLD = 1.5
    
    # é™éŸ³æ£€æµ‹å‚æ•°
    MIN_SILENCE_LEN = 500   # æ¯«ç§’
    SILENCE_THRESH = -40    # dB
    
    # Whisper æ¨¡å‹ï¼ˆtiny/base/small/mediumï¼‰
    WHISPER_MODEL = "base"
    
    # ========== æ‰§è¡Œæµç¨‹ ==========
    
    semi_auto_workflow(
        input_audio=INPUT_AUDIO,
        image_folder=IMAGE_FOLDER,
        template_path=TEMPLATE_PATH,
        output_base_folder=OUTPUT_BASE_FOLDER,
        draft_name=DRAFT_NAME,
        jianying_drafts_folder=JIANYING_DRAFTS_FOLDER,
        duration_threshold=DURATION_THRESHOLD,
        min_silence_len=MIN_SILENCE_LEN,
        silence_thresh=SILENCE_THRESH,
        whisper_model=WHISPER_MODEL
    )
```

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿è¯¦è§£

### 1. ä¿ç•™æ–¹æ¡ˆ A çš„æ™ºèƒ½é€»è¾‘

```python
# æ™ºèƒ½å›¾ç‰‡åˆ†é…ç®—æ³•ï¼ˆå®Œå…¨ç»§æ‰¿ï¼‰
if duration < 1.5:
    é…1å¼ å›¾ç‰‡
else:
    é…2å¼ å›¾ç‰‡ï¼ˆå¹³å‡åˆ†é…ï¼‰
```

### 2. å¢åŠ 3ä¸ªäººå·¥æ£€æŸ¥ç‚¹

```
æ£€æŸ¥ç‚¹ â‘ : éŸ³é¢‘å¤„ç†å
    â””â”€ è¯•å¬æ•ˆæœï¼Œè°ƒæ•´å‚æ•°

æ£€æŸ¥ç‚¹ â‘¡: å­—å¹•ç”Ÿæˆå
    â””â”€ æ ¡å¯¹æ–‡å­—ï¼Œä¿®æ­£é”™è¯¯

æ£€æŸ¥ç‚¹ â‘¢: è‰ç¨¿ç”Ÿæˆå
    â””â”€ å‰ªæ˜ ä¸­ç²¾ä¿®ï¼Œæ·»åŠ ç‰¹æ•ˆ
```

### 3. çµæ´»çš„å‚æ•°è°ƒæ•´

| å‚æ•° | é»˜è®¤å€¼ | è°ƒæ•´æ–¹å‘ |
|------|-------|---------|
| `duration_threshold` | 1.5ç§’ | æ§åˆ¶å›¾ç‰‡åˆ‡æ¢é¢‘ç‡ |
| `min_silence_len` | 500ms | æ§åˆ¶åˆ é™¤çš„é™éŸ³é•¿åº¦ |
| `silence_thresh` | -40dB | æ§åˆ¶é™éŸ³æ£€æµ‹çµæ•åº¦ |
| `whisper_model` | base | æ§åˆ¶è¯†åˆ«é€Ÿåº¦/è´¨é‡ |

---

## ğŸ“– ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆåˆ›å»ºæ¨¡æ¿ï¼‰

```bash
# 1. åœ¨å‰ªæ˜ ä¸­åˆ›å»ºä¸€ä¸ªåŸºç¡€é¡¹ç›®
#    - æ·»åŠ é»‘è‰²èƒŒæ™¯
#    - è®¾ç½®16:9åˆ†è¾¨ç‡
#    - æ·»åŠ é»˜è®¤èƒŒæ™¯éŸ³ä¹ï¼ˆå¯é€‰ï¼‰
#    - ä¿å­˜é¡¹ç›®

# 2. æ‰¾åˆ°å‰ªæ˜ è‰ç¨¿æ–‡ä»¶
#    macOS: ~/Movies/JianyingPro/User Data/Projects/com.lveditor.draft/

# 3. å¤åˆ¶è‰ç¨¿ä½œä¸ºæ¨¡æ¿
cp -r "ä½ çš„è‰ç¨¿æ–‡ä»¶å¤¹" /path/to/template_draft/
```

### æ—¥å¸¸ä½¿ç”¨

```bash
# 1. ä¿®æ”¹é…ç½®è·¯å¾„
INPUT_AUDIO = "ä½ çš„éŸ³é¢‘.mp3"
IMAGE_FOLDER = "ä½ çš„å›¾ç‰‡æ–‡ä»¶å¤¹"

# 2. è¿è¡Œè„šæœ¬
python semi_auto_generator.py

# 3. æŒ‰æç¤ºæ“ä½œ
#    - ç¡®è®¤éŸ³é¢‘æ•ˆæœ
#    - ç¡®è®¤å­—å¹•å‡†ç¡®æ€§
#    - åœ¨å‰ªæ˜ ä¸­ç²¾ä¿®
#    - å¯¼å‡ºè§†é¢‘
```

---

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### å®‰è£…ä¾èµ–

```bash
# ä¸æ–¹æ¡ˆ A ç›¸åŒ
pip install pydub whisper moviepy mutagen
brew install ffmpeg  # macOS
```

### å‰ªæ˜ å®‰è£…

```bash
# macOS
ä¸‹è½½: https://lv.ulikecam.com/

# Windows
ä¸‹è½½: https://www.capcut.cn/
```

---

## âš™ï¸ å‚æ•°è°ƒä¼˜æŒ‡å—

### åœºæ™¯ 1: éŸ³é¢‘é—´éš™å¤ªå¤š

```python
# å¢å¤§é™éŸ³é•¿åº¦é˜ˆå€¼
MIN_SILENCE_LEN = 800  # ä» 500 å¢åŠ åˆ° 800

# æˆ–é™ä½é™éŸ³éŸ³é‡é˜ˆå€¼
SILENCE_THRESH = -35  # ä» -40 æé«˜åˆ° -35
```

### åœºæ™¯ 2: å›¾ç‰‡åˆ‡æ¢å¤ªå¿«

```python
# æé«˜çŸ­/é•¿éŸ³é¢‘é˜ˆå€¼
DURATION_THRESHOLD = 2.0  # ä» 1.5 æé«˜åˆ° 2.0
# æ•ˆæœï¼šæ›´å¤šéŸ³é¢‘æ®µä¼šè¢«åˆ†é…2å¼ å›¾ç‰‡
```

### åœºæ™¯ 3: å­—å¹•è¯†åˆ«ä¸å‡†

```python
# ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹
WHISPER_MODEL = "small"  # ä» base å‡çº§åˆ° small
# æˆ–æ‰‹åŠ¨ç¼–è¾‘ SRT æ–‡ä»¶
```

---

## ğŸš€ è¿›é˜¶æŠ€å·§

### æ‰¹é‡å¤„ç†å¤šä¸ªæ•…äº‹

```python
def batch_process_stories(story_configs: List[dict]):
    """æ‰¹é‡å¤„ç†å¤šä¸ªæ•…äº‹"""
    for i, config in enumerate(story_configs, 1):
        print(f"\n{'='*70}")
        print(f"å¤„ç†æ•…äº‹ {i}/{len(story_configs)}: {config['draft_name']}")
        print(f"{'='*70}")
        
        semi_auto_workflow(**config)
        
        # æš‚åœï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
        if i < len(story_configs):
            input(f"\næ•…äº‹ {i} å®Œæˆï¼ŒæŒ‰ Enter å¤„ç†ä¸‹ä¸€ä¸ª...\n")

# ä½¿ç”¨
stories = [
    {
        "input_audio": "story1/audio.mp3",
        "image_folder": "story1/images",
        "draft_name": "story_01",
        # ... å…¶ä»–å‚æ•°
    },
    {
        "input_audio": "story2/audio.mp3",
        "image_folder": "story2/images",
        "draft_name": "story_02",
        # ... å…¶ä»–å‚æ•°
    }
]

batch_process_stories(stories)
```

### è‡ªå®šä¹‰å›¾ç‰‡åˆ†é…ç­–ç•¥

```python
# åœ¨ create_jianying_draft_step() ä¸­ä¿®æ”¹

# ç­–ç•¥1: æ›´æ¿€è¿›çš„åˆ‡æ¢ï¼ˆæ›´å¤šåŒå›¾ï¼‰
DURATION_THRESHOLD = 1.0

# ç­–ç•¥2: å›ºå®šæ¯ä¸ªå¥å­2å¼ å›¾
for segment in segments:
    # æ— è®ºæ—¶é•¿ï¼Œéƒ½åˆ†é…2å¼ å›¾ç‰‡
    é…2å¼ å›¾ç‰‡

# ç­–ç•¥3: æŒ‰å…³é”®è¯åˆ‡æ¢
if "important" in segment['text']:
    é…3å¼ å›¾ç‰‡  # é‡ç‚¹å†…å®¹å¤šé…å›¾
else:
    é…1å¼ å›¾ç‰‡
```

### æ·»åŠ è‡ªåŠ¨è½¬åœº

```python
# åœ¨ç”Ÿæˆè‰ç¨¿æ—¶æ·»åŠ è½¬åœºæ•ˆæœï¼ˆéœ€è¦ç ”ç©¶å‰ªæ˜ è‰ç¨¿æ ¼å¼ï¼‰
# æˆ–åœ¨å‰ªæ˜ ä¸­æ‰‹åŠ¨æ‰¹é‡æ·»åŠ 
```

---

## ğŸ“Š æ–¹æ¡ˆ A vs æ–¹æ¡ˆ B å¯¹æ¯”

### å®é™…å·¥ä½œæµç¨‹å¯¹æ¯”

| æ­¥éª¤ | æ–¹æ¡ˆ A | æ–¹æ¡ˆ B |
|------|--------|--------|
| 1. éŸ³é¢‘å¤„ç† | è‡ªåŠ¨ | è‡ªåŠ¨ + äººå·¥ç¡®è®¤ |
| 2. è¯­éŸ³è¯†åˆ« | è‡ªåŠ¨ | è‡ªåŠ¨ + äººå·¥æ ¡å¯¹ |
| 3. å›¾ç‰‡åˆ†é… | è‡ªåŠ¨ï¼ˆå›ºå®šï¼‰ | è‡ªåŠ¨ + å‰ªæ˜ è°ƒæ•´ |
| 4. å­—å¹•æ ·å¼ | ä»£ç å›ºå®š | å‰ªæ˜ å¯è§†åŒ–è°ƒæ•´ |
| 5. ç‰¹æ•ˆè½¬åœº | æ—  | å‰ªæ˜ ä¸­æ·»åŠ  |
| 6. èƒŒæ™¯éŸ³ä¹ | æ—  | å‰ªæ˜ ä¸­æ·»åŠ  |
| 7. æœ€ç»ˆå¯¼å‡º | Pythonå¯¼å‡º | å‰ªæ˜ å¯¼å‡º |

### æ—¶é—´æˆæœ¬å¯¹æ¯”

```
æ–¹æ¡ˆ Aï¼ˆ1åˆ†é’Ÿè§†é¢‘ï¼‰:
â”œâ”€â”€ è‡ªåŠ¨å¤„ç†: 3-5åˆ†é’Ÿ
â””â”€â”€ æ€»æ—¶é—´: 3-5åˆ†é’Ÿ

æ–¹æ¡ˆ Bï¼ˆ1åˆ†é’Ÿè§†é¢‘ï¼‰:
â”œâ”€â”€ è‡ªåŠ¨å¤„ç†: 2åˆ†é’Ÿ
â”œâ”€â”€ äººå·¥ç¡®è®¤: 2åˆ†é’Ÿ
â”œâ”€â”€ å‰ªæ˜ ç²¾ä¿®: 5-10åˆ†é’Ÿ
â””â”€â”€ æ€»æ—¶é—´: 9-14åˆ†é’Ÿ

æ‰‹åŠ¨å‰ªè¾‘ï¼ˆ1åˆ†é’Ÿè§†é¢‘ï¼‰:
â”œâ”€â”€ å¯¼å…¥ç´ æ: 2åˆ†é’Ÿ
â”œâ”€â”€ å‰ªè¾‘å¯¹é½: 10-15åˆ†é’Ÿ
â”œâ”€â”€ æ·»åŠ å­—å¹•: 5-10åˆ†é’Ÿ
â”œâ”€â”€ ç‰¹æ•ˆè°ƒæ•´: 5-10åˆ†é’Ÿ
â””â”€â”€ æ€»æ—¶é—´: 22-37åˆ†é’Ÿ
```

### è´¨é‡å¯¹æ¯”

```
æ–¹æ¡ˆ A: â­â­â­
    â”œâ”€â”€ ä¼˜ç‚¹: å¿«é€Ÿä¸€è‡´
    â””â”€â”€ ç¼ºç‚¹: ç¼ºå°‘ä¸ªæ€§åŒ–

æ–¹æ¡ˆ B: â­â­â­â­â­
    â”œâ”€â”€ ä¼˜ç‚¹: è‡ªåŠ¨åŒ– + å¯å®šåˆ¶
    â””â”€â”€ ç¼ºç‚¹: éœ€è¦ä¸€å®šæ—¶é—´

æ‰‹åŠ¨å‰ªè¾‘: â­â­â­â­
    â”œâ”€â”€ ä¼˜ç‚¹: å®Œå…¨æ§åˆ¶
    â””â”€â”€ ç¼ºç‚¹: è€—æ—¶ä¸”é‡å¤æ€§é«˜
```

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### 1. é¦–æ¬¡ä½¿ç”¨æµç¨‹

```
Day 1: ç¯å¢ƒæ­å»º
    â”œâ”€â”€ å®‰è£… Python ä¾èµ–
    â”œâ”€â”€ åˆ›å»ºå‰ªæ˜ æ¨¡æ¿
    â””â”€â”€ æµ‹è¯•å°æ ·æœ¬ï¼ˆ10ç§’éŸ³é¢‘ï¼‰

Day 2: å‚æ•°è°ƒä¼˜
    â”œâ”€â”€ è°ƒæ•´é™éŸ³æ£€æµ‹å‚æ•°
    â”œâ”€â”€ è°ƒæ•´å›¾ç‰‡åˆ‡æ¢é˜ˆå€¼
    â””â”€â”€ ç†Ÿæ‚‰å‰ªæ˜ æ“ä½œ

Day 3: æ­£å¼ç”Ÿäº§
    â””â”€â”€ æ‰¹é‡å¤„ç†è§†é¢‘
```

### 2. æ–‡ä»¶ç»„ç»‡å»ºè®®

```
é¡¹ç›®æ–‡ä»¶å¤¹/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ semi_auto_generator.py
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ base_draft/
â”‚       â””â”€â”€ draft_content.json
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ story_01/
â”‚   â”‚   â”œâ”€â”€ audio.mp3
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ output/
â”‚   â””â”€â”€ story_02/
â”‚       â”œâ”€â”€ audio.mp3
â”‚       â”œâ”€â”€ images/
â”‚       â””â”€â”€ output/
â””â”€â”€ final_videos/
    â”œâ”€â”€ story_01.mp4
    â””â”€â”€ story_02.mp4
```

### 3. è´¨é‡æ£€æŸ¥æ¸…å•

```
éŸ³é¢‘è´¨é‡ âœ“
    â˜ æ— æ˜æ˜¾æ‚éŸ³
    â˜ éŸ³é‡é€‚ä¸­
    â˜ é™éŸ³åˆ é™¤åˆç†

å­—å¹•è´¨é‡ âœ“
    â˜ æ–‡å­—å‡†ç¡®
    â˜ æ—¶é—´å¯¹é½
    â˜ æ— é”™åˆ«å­—

ç”»é¢è´¨é‡ âœ“
    â˜ å›¾ç‰‡æ¸…æ™°
    â˜ åˆ‡æ¢è‡ªç„¶
    â˜ æ¯”ä¾‹æ­£ç¡® (16:9)

æ•´ä½“æ•ˆæœ âœ“
    â˜ éŸ³ç”»åŒæ­¥
    â˜ èŠ‚å¥æµç•…
    â˜ æ— å¡é¡¿
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ‰¾ä¸åˆ°å‰ªæ˜ è‰ç¨¿æ–‡ä»¶å¤¹ï¼Ÿ

```bash
# macOS è·¯å¾„
~/Movies/JianyingPro/User Data/Projects/com.lveditor.draft/

# Windows è·¯å¾„
C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\JianyingPro\User Data\Projects\com.lveditor.draft\
```

### Q2: è‰ç¨¿åœ¨å‰ªæ˜ ä¸­æ— æ³•æ‰“å¼€ï¼Ÿ

```
å¯èƒ½åŸå› :
1. draft_content.json æ ¼å¼é”™è¯¯
2. è·¯å¾„ä¸­åŒ…å«ç‰¹æ®Šå­—ç¬¦
3. å‰ªæ˜ ç‰ˆæœ¬ä¸å…¼å®¹

è§£å†³æ–¹æ¡ˆ:
1. ä½¿ç”¨æœ€æ–°ç‰ˆå‰ªæ˜ 
2. æ£€æŸ¥ JSON æ ¼å¼
3. é‡æ–°åˆ›å»ºæ¨¡æ¿
```

### Q3: å›¾ç‰‡åœ¨å‰ªæ˜ ä¸­æ˜¾ç¤ºä¸æ­£ç¡®ï¼Ÿ

```
æ£€æŸ¥:
1. å›¾ç‰‡è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆç»å¯¹è·¯å¾„ï¼‰
2. å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨
3. å›¾ç‰‡æ ¼å¼æ˜¯å¦æ”¯æŒï¼ˆPNG/JPGï¼‰

è§£å†³:
åœ¨å‰ªæ˜ ä¸­é‡æ–°å¯¼å…¥å›¾ç‰‡
```

---

## ğŸ“ æ€»ç»“

### æ–¹æ¡ˆ B çš„æ ¸å¿ƒä»·å€¼

```
è‡ªåŠ¨åŒ–éƒ¨åˆ†ï¼ˆçœæ—¶ï¼‰:
âœ… éŸ³é¢‘é™éŸ³ç§»é™¤ (çœ80%æ—¶é—´)
âœ… è¯­éŸ³è¯†åˆ«ç”Ÿæˆå­—å¹• (çœ90%æ—¶é—´)
âœ… æ™ºèƒ½å›¾ç‰‡åˆ†é… (çœ70%æ—¶é—´)

äººå·¥éƒ¨åˆ†ï¼ˆæè´¨ï¼‰:
âœ… å‚æ•°å¾®è°ƒ
âœ… å­—å¹•æ ¡å¯¹
âœ… è§†è§‰æ•ˆæœ
âœ… ç‰¹æ•ˆè½¬åœº

æœ€ç»ˆæ•ˆæœ:
= æ–¹æ¡ˆAçš„é€Ÿåº¦ Ã— 0.5
+ æ‰‹åŠ¨å‰ªè¾‘çš„è´¨é‡ Ã— 0.9
```

### é€‚ç”¨åœºæ™¯

**âœ… æœ€é€‚åˆï¼š**
- éœ€è¦æ‰¹é‡ç”Ÿäº§è§†é¢‘
- å¯¹è´¨é‡æœ‰ä¸€å®šè¦æ±‚
- æ„¿æ„èŠ±æ—¶é—´ç²¾ä¿®
- ç†Ÿæ‚‰å‰ªæ˜ æ“ä½œ

**âŒ ä¸é€‚åˆï¼š**
- åªåšä¸€ä¸ªè§†é¢‘ï¼ˆç›´æ¥æ‰‹åŠ¨æ›´å¿«ï¼‰
- å®Œå…¨ä¸æ‡‚å‰ªæ˜ 
- éœ€è¦æè‡´è‡ªåŠ¨åŒ–

### åç»­ä¼˜åŒ–æ–¹å‘

- [ ] è‡ªåŠ¨æ·»åŠ å­—å¹•æ ·å¼æ¨¡æ¿
- [ ] æ”¯æŒæ›´å¤šè½¬åœºæ•ˆæœ
- [ ] AI æ™ºèƒ½é…éŸ³
- [ ] è‡ªåŠ¨ç”Ÿæˆå°é¢
- [ ] Web ç•Œé¢åŒ–æ“ä½œ

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*æœ€åæ›´æ–°: 2025-10-14*  
*ä½œè€…: Claude + ç”¨æˆ·åä½œ*

